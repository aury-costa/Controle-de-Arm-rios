<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Controle de Arm√°rios</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">üîê</div>
      <div>
        <div class="title">Controle de Arm√°rios</div>
        <div class="subtitle">Firebase Realtime Database ‚Ä¢ tempo real</div>
      </div>
    </div>
    <div class="status">
      <span id="connDot" class="dot"></span>
      <span id="connText">Conectando‚Ä¶</span>
    </div>
  </header>

  <main class="container">
    <div id="globalAlert" class="alert hidden" role="alert">
      <strong>‚ö†Ô∏è Aten√ß√£o:</strong> existem arm√°rios sem c√≥pias de chave dispon√≠veis (0 dispon√≠veis).
      <button id="btnIrRisco" class="btn small ghost">Ver relat√≥rio</button>
    </div>

    <nav class="tabs">
      <button class="tab active" data-tab="tabColabs">üë• Colaboradores</button>
      <button class="tab" data-tab="tabArmarios">üß∞ Arm√°rios</button>
      <button class="tab" data-tab="tabHistorico">üìú Hist√≥rico</button>
      <button class="tab" data-tab="tabConfig">‚öôÔ∏è Config</button>
    </nav>

    <section id="tabColabs" class="panel">
      <div class="panelHeader">
        <div>
          <h2>Colaboradores</h2>
          <div class="muted" id="colabStats">‚Äî</div>
        </div>
        <div class="panelActions">
          <input id="qColab" class="input" placeholder="Buscar por matr√≠cula, nome, cargo‚Ä¶"/>
          <button id="btnNovo" class="btn primary">+ Novo</button>
          <button id="btnExportJSON" class="btn">üì¶ Backup JSON</button>
          <button id="btnImportJSON" class="btn ghost">Importar JSON</button>
          <input id="fileImportJSON" type="file" accept="application/json" hidden/>
          <button id="btnExportXML" class="btn">üìÑ Exportar XML</button>
          <button id="btnImportXML" class="btn ghost">Importar XML</button>
          <input id="fileImportXML" type="file" accept=".xml,application/xml,text/xml" hidden/>
        </div>
      </div>

      <div class="tableWrap">
        <table class="table">
          <thead>
            <tr>
              <th>Matr√≠cula</th>
              <th>Nome</th>
              <th>Admiss√£o</th>
              <th>Cargo</th>
              <th>Arm√°rio</th>
              <th>Posi√ß√£o</th>
              <th>Chave entregue</th>
              <th style="width:1%">A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="tbodyColabs"></tbody>
        </table>
      </div>
    </section>

    <section id="tabArmarios" class="panel hidden">
      <div class="panelHeader">
        <div>
          <h2>Arm√°rios</h2>
          <div class="muted" id="lockerStats">‚Äî</div>
        </div>
        <div class="panelActions">
          <select id="fStatus" class="input">
            <option value="all">Todos</option>
            <option value="free">Livres</option>
            <option value="busy">Ocupados</option>
          </select>
          <select id="fPos" class="input">
            <option value="all">Cima+Baixo</option>
            <option value="CIMA">S√≥ CIMA</option>
            <option value="BAIXO">S√≥ BAIXO</option>
          </select>
          <input id="qLocker" class="input" placeholder="Ir para n¬∫ (ex: 42)"/>
          <button id="btnCopiarVisiveis" class="btn ghost">üìã Copiar lista vis√≠vel</button>
        </div>
      </div>

      <div class="grid2">
        <div class="card">
          <h3>Configurar posi√ß√£o (CIMA/BAIXO) por n√∫mero</h3>
          <div class="row">
            <input id="posNum" class="input" type="number" min="1" placeholder="N√∫mero do arm√°rio"/>
            <select id="posVal" class="input">
              <option value="BAIXO">BAIXO</option>
              <option value="CIMA">CIMA</option>
            </select>
            <button id="btnSalvarPos" class="btn">Salvar</button>
          </div>
          <div class="muted">Se n√£o configurar um n√∫mero, vale a regra padr√£o da aba Config.</div>
        </div>

        <div class="card">
          <h3>Chaves por arm√°rio (c√≥pias)</h3>
          <div class="row">
            <input id="keyNum" class="input" type="number" min="1" placeholder="N√∫mero do arm√°rio"/>
            <input id="keyTotal" class="input" type="number" min="1" placeholder="Total de chaves (c√≥pias)"/>
            <button id="btnSalvarChaves" class="btn">Salvar</button>
            <button id="btnMaisCopia" class="btn ghost">+1 c√≥pia</button>
          </div>
          <div class="muted">Padr√£o: 1 chave por arm√°rio se n√£o configurar.</div>
        </div>
      </div>

      <div class="card">
        <h3>Mapa de arm√°rios</h3>
        <div class="muted">Clique em um arm√°rio <b>ocupado</b> para ir direto ao colaborador. Clique em um arm√°rio <b>livre</b> para copiar o n√∫mero.</div>
        <div id="lockerGrid" class="lockerGrid"></div>
      </div>

      <div class="card">
        <h3>Relat√≥rio: arm√°rios em risco</h3>
        <div class="muted">‚ÄúRisco‚Äù = arm√°rio com <b>somente 1 chave</b> (1 c√≥pia total).</div>
        <ul id="riskList" class="list"></ul>
      </div>
    </section>

    <section id="tabHistorico" class="panel hidden">
      <div class="panelHeader">
        <div>
          <h2>Hist√≥rico de chaves</h2>
          <div class="muted">Registros de entrega, devolu√ß√£o e c√≥pias.</div>
        </div>
        <div class="panelActions">
          <button id="btnExportHist" class="btn ghost">üì§ Exportar (CSV)</button>
          <button id="btnLimparHist" class="btn danger ghost">Limpar hist√≥rico</button>
        </div>
      </div>
      <div class="tableWrap">
        <table class="table">
          <thead>
            <tr>
              <th>Data/Hora</th>
              <th>A√ß√£o</th>
              <th>Arm√°rio</th>
              <th>Matr√≠cula</th>
              <th>Nome</th>
              <th>Detalhe</th>
            </tr>
          </thead>
          <tbody id="tbodyHist"></tbody>
        </table>
      </div>
      <div class="muted">Dica: para seguran√ßa, ajuste regras do Firebase e use autentica√ß√£o se necess√°rio.</div>
    </section>

    <section id="tabConfig" class="panel hidden">
      <div class="grid2">
        <div class="card">
          <h3>Configura√ß√µes gerais</h3>
          <div class="row">
            <label class="lbl">Total de arm√°rios</label>
            <input id="cfgTotal" class="input" type="number" min="1"/>
          </div>
          <div class="row">
            <label class="lbl">Regra padr√£o: at√© este n¬∫ √© BAIXO</label>
            <input id="cfgBaixoAte" class="input" type="number" min="0"/>
          </div>
          <div class="row">
            <button id="btnSalvarConfig" class="btn primary">Salvar configura√ß√µes</button>
          </div>
          <div class="muted">Ex.: BAIXO at√© 150 ‚Üí 1..150 BAIXO, 151..Total CIMA.</div>
        </div>

        <div class="card">
          <h3>Ajuda r√°pida</h3>
          <ol class="muted">
            <li>Cadastre/importe colaboradores na aba <b>Colaboradores</b>.</li>
            <li>Atribua arm√°rio e entregue/devolva chaves no formul√°rio do colaborador.</li>
            <li>Configure c√≥pias (total de chaves) por arm√°rio na aba <b>Arm√°rios</b>.</li>
            <li>O alerta aparece se algum arm√°rio ficar com <b>0 chaves dispon√≠veis</b>.</li>
          </ol>
        </div>
      </div>
    </section>

  </main>

  <div id="modal" class="modal hidden" aria-hidden="true">
    <div class="modalCard">
      <div class="modalHeader">
        <h3 id="modalTitle">Colaborador</h3>
        <button id="btnCloseModal" class="btn ghost small">‚úï</button>
      </div>

      <form id="formColab" class="form">
        <div class="grid2">
          <div>
            <label class="lbl">Matr√≠cula (Cadastro)</label>
            <input id="fMat" class="input" required/>
          </div>
          <div>
            <label class="lbl">Nome</label>
            <input id="fNome" class="input" required/>
          </div>
          <div>
            <label class="lbl">Admiss√£o</label>
            <input id="fAdm" class="input" type="date"/>
          </div>
          <div>
            <label class="lbl">Cargo</label>
            <input id="fCargo" class="input"/>
          </div>
          <div>
            <label class="lbl">Arm√°rio</label>
            <select id="fArmario" class="input"></select>
            <div class="muted" id="armInfo">‚Äî</div>
          </div>
          <div>
            <label class="lbl">Chave entregue em</label>
            <input id="fChaveEnt" class="input" type="date"/>
            <div class="row">
              <button id="btnEntregarAgora" type="button" class="btn ghost">üîë Entregar agora</button>
              <button id="btnDevolver" type="button" class="btn ghost">‚Ü©Ô∏è Devolver</button>
            </div>
          </div>
        </div>

        <div class="row between">
          <div class="muted" id="editHint">‚Äî</div>
          <div class="row">
            <button id="btnExcluir" type="button" class="btn danger ghost hidden">Excluir</button>
            <button class="btn primary" type="submit">Salvar</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <script type="module" src="app.js"></script>
</body>
</html>
